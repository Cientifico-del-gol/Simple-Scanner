import csv

convlist=list()
unique_exes=set()

print('Reading and parsing .csv database...')

with open('full.csv', mode='r',  encoding='utf-8') as file:
    csvfh = csv.DictReader(file, fieldnames=['F'])
    for row in csvfh:
        exe_position = row['F'].find('.exe')
        data = row['F'][:exe_position + 4]
        if exe_position==-1:
            continue
        else:
            convlist.append(data)
    
    for line in convlist:
        exe=line.rsplit('"',1)[-1].strip()
        unique_exes.add(exe)

print('Threat names identified!')

print('Extracting them in a txt file...')

convlist2=list(unique_exes)
with open('newlistmalware.txt', 'w', encoding='utf-8') as output_file:
    output_file.write(",".join(convlist2))

print('Results extracted to newlistmalware.txt')

print('All done!')

import os

path='C:/'
pathfinder=os.fsencode(path)

print('Scanning computer...')

exelist=list()
for dirpath, dirnames, filenames in os.walk(path):
    for fname in filenames:
        if fname.endswith('.exe'):
            exelist.append(fname)

print('Computer scan finished!')

print('Comparing results to known malware database...')

threatlist=set()
with open('newlistmalware.txt', 'r', encoding='utf-8') as file:
    for line in file:
        for item in exelist:
            if item in line:
                threatlist.add(item)
                #count+=1

count=len(threatlist)
print('Possible threats found:',count)

print('Printing possible threats in a txt file!')

with open('Possiblethreats.txt', 'w', encoding='utf-8') as lst:
    lst.write(f'Total possible threats:{count}\n')
    for exe in threatlist:
        lst.write(exe+'\n')
    #lst.write('\n'.join(threatlist))

print('Possible threats txt printed!')
print('All done!')